@inject ISnackbar Snackbar

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="Icons.Material.Filled.Warning" Class="mr-3" Color="Color.Warning"/>
            บังคับปิดคอกสุกร
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudCard Elevation="0" Class="mb-4">
            <MudCardContent>
                <MudAlert Severity="Severity.Warning" Dense="true" Class="mb-4">
                    <MudText Typo="Typo.subtitle2" Class="mb-2">
                        ⚠️ คำเตือน: คุณกำลังจะบังคับปิดคอกสุกรนี้
                    </MudText>
                    <MudText Typo="Typo.body2">
                        การดำเนินการนี้จะทำเครื่องหมายว่าคอกสุกรเสร็จสิ้นแล้ว แม้ว่าจะยังไม่ได้จับสุกรครบทั้งหมด 
                        วันที่จับสุกรจริงจะถูกตั้งเป็นวันนี้
                    </MudText>
                </MudAlert>
                
                @if (PigPen != null && HarvestInfo != null)
                {
                    <MudGrid>
                        <MudItem xs="12">
                            <MudText Typo="Typo.subtitle1" Class="mb-2">
                                <strong>รายละเอียดคอกสุกร:</strong>
                            </MudText>
                        </MudItem>
                        <MudItem xs="6">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">รหัสคอก:</MudText>
                            <MudText Typo="Typo.body1"><strong>@PigPen.PenCode</strong></MudText>
                        </MudItem>
                        <MudItem xs="6">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">จำนวนสุกรทั้งหมด:</MudText>
                            <MudText Typo="Typo.body1"><strong>@PigPen.PigQty ตัว</strong></MudText>
                        </MudItem>
                        <MudItem xs="6">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">จับแล้ว:</MudText>
                            <MudText Typo="Typo.body1" Color="Color.Info">
                                <strong>@HarvestInfo.HarvestedPigQuantity ตัว</strong>
                            </MudText>
                        </MudItem>
                        <MudItem xs="6">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">คงเหลือ:</MudText>
                            <MudText Typo="Typo.body1" Color="@(HarvestInfo.RemainingPigQuantity > 0 ? Color.Warning : Color.Success)">
                                <strong>@HarvestInfo.RemainingPigQuantity ตัว</strong>
                            </MudText>
                        </MudItem>
                        
                        @if (HarvestInfo.RemainingPigQuantity > 0)
                        {
                            <MudItem xs="12">
                                <MudDivider Class="my-2" />
                                <MudAlert Severity="Severity.Info" Dense="true">
                                    <MudText Typo="Typo.body2">
                                        <strong>@HarvestInfo.RemainingPigQuantity ตัว</strong> จะถูกทำเครื่องหมายว่าไม่ได้ถูกบันทึก 
                                        สาเหตุที่พบบ่อย:
                                    </MudText>
                                    <ul style="margin: 8px 0; padding-left: 20px;">
                                        <li>สุกรตายระหว่างการเลี้ยง</li>
                                        <li>เก็บไว้เพื่อการเพาะพันธุ์</li>
                                        <li>ขายผ่านช่องทางอื่น</li>
                                        <li>ต้องแก้ไขข้อมูล</li>
                                    </ul>
                                </MudAlert>
                            </MudItem>
                        }
                        
                        <MudItem xs="12">
                            <MudDivider Class="my-2" />
                            <MudText Typo="Typo.subtitle2" Class="mb-2">
                                การดำเนินการที่จะเกิดขึ้น:
                            </MudText>
                            <MudList Dense="true">
                                <MudListItem Icon="Icons.Material.Filled.CalendarToday" Text="ตั้งวันที่จับสุกรจริงเป็นวันนี้" />
                                <MudListItem Icon="Icons.Material.Filled.Block" Text="ทำเครื่องหมายคอกสุกรว่าเสร็จสิ้น/ปิดแล้ว" />
                                <MudListItem Icon="Icons.Material.Filled.Lock" Text="ป้องกันการเพิ่มรายการจับสุกรเพิ่มเติม" />
                            </MudList>
                        </MudItem>
                    </MudGrid>
                }
            </MudCardContent>
        </MudCard>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">ยกเลิก</MudButton>
        <MudButton Color="Color.Warning" 
                   Variant="Variant.Filled" 
                   OnClick="Confirm"
                   StartIcon="Icons.Material.Filled.Warning">
            บังคับปิดคอก
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] public MudDialogInstance MudDialog { get; set; } = default!;
    
    [Parameter] public PigPen? PigPen { get; set; }
    [Parameter] public HarvestCalculationInfo? HarvestInfo { get; set; }

    private void Cancel() => MudDialog.Cancel();
    
    private void Confirm() => MudDialog.Close(DialogResult.Ok(true));
}