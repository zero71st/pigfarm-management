@page "/dashboard"
@using Microsoft.AspNetCore.Components
@using MudBlazor
@using PigFarmManagement.Shared.Models
@using PigFarmManagement.Client.Features.Dashboard.Services
@inject IDashboardService DashboardService
@inject ISnackbar Snackbar

<PageTitle>PigTrack Pro - Dashboard</PageTitle>

<MudText Typo="Typo.h4" GutterBottom="true">Pig Farm Management Dashboard</MudText>

@if (loading)
{
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="ma-2" />
}
else if (dashboardOverview != null)
{
    <!-- Dashboard Overview Cards -->
    <DashboardOverviewCards Overview="dashboardOverview" />
    
    <!-- Customer Performance Table -->
    <CustomerStatsTable CustomerStats="dashboardOverview.CustomerStats" />
}

@code {
    private DashboardOverview? dashboardOverview;
    private bool loading = true;
    private string searchText = "";

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private async Task LoadData()
    {
        try
        {
            loading = true;

            dashboardOverview = await DashboardService.GetDashboardOverviewAsync();
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading data: {ex.Message}", Severity.Error);
        }
        finally
        {
            loading = false;
        }
    }
}
