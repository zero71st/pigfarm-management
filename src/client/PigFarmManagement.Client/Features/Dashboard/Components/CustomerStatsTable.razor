@using PigFarmManagement.Shared.Models
@using System.Globalization

<MudCard Elevation="3" Class="mt-4">
    <MudCardHeader class="ml-4">
        <CardHeaderContent>
            <MudText Typo="Typo.h6">
                <MudIcon Icon="@Icons.Material.Filled.Business" Class="mr-2" Color="Color.Info" />
                สรุปผลการดำเนินงานของลูกค้า (โครงการ)
            </MudText>
        </CardHeaderContent>
    </MudCardHeader>
    <MudCardContent class="ml-4">
        <MudTable Items="@CustomerStats" Hover="true" Striped="true" Dense="true" RowsPerPage="10">
            <HeaderContent>
                <MudTh>ชื่อลูกค้า</MudTh>
                <MudTh>จำนวนคอก</MudTh>
                <MudTh>จำนวนสุกร</MudTh>
                <MudTh>เงินลงทุนทั้งหมด</MudTh>
                <MudTh>เงินลงทุนส่วนของร้าน</MudTh>
                <MudTh>เงินลงทุนส่วนลูกค้า (มัดจำ)</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="ชื่อลูกค้า">@context.CustomerName</MudTd>
                <MudTd DataLabel="จำนวนคอก">@context.PigPenCount</MudTd>
                <MudTd DataLabel="จำนวนสุกร">@context.TotalPigs</MudTd>
                <MudTd DataLabel="เงินลงทุนทั้งหมด">@FormatCurrency(context.TotalInvestment)</MudTd>
                <MudTd DataLabel="เงินลงทุนส่วนของร้าน">
                    <span style="color: @(CalculateOwnerPlusProfit(context) >= 0 ? "green" : "red")">
                        @FormatCurrency(CalculateOwnerPlusProfit(context))
                    </span>
                </MudTd>
                <MudTd DataLabel="เงินลงทุนส่วนลูกค้า (มัดจำ)">@FormatCurrency(context.TotalCustomerCapital)</MudTd>
            </RowTemplate>
            <PagerContent>
                @if (CustomerStats?.Count > 10)
                {
                    <MudTablePager />
                }
            </PagerContent>
        </MudTable>
    </MudCardContent>
</MudCard>

@code {
    [Parameter] public List<CustomerPigPenStats> CustomerStats { get; set; } = new();

    private string FormatCurrency(decimal amount)
    {
        return amount.ToString("N2", new CultureInfo("th-TH"));
    }

    private decimal CalculateOwnerPlusProfit(CustomerPigPenStats stats)
    {
        return stats.TotalOwnerCapital + stats.TotalProfitLoss;
    }

    private string FormatPercentage(decimal percentage)
    {
        return percentage.ToString("P1", new CultureInfo("th-TH"));
    }

    private decimal CalculateROI(decimal profit, decimal investment)
    {
        return investment != 0 ? profit / investment : 0;
    }

    private Color GetCustomerStatusColor(CustomerStatus status)
    {
        return status switch
        {
            CustomerStatus.Active => Color.Success,
            CustomerStatus.Inactive => Color.Error,
            _ => Color.Default
        };
    }
}
