@using Microsoft.AspNetCore.Components
@using MudBlazor
@using PigFarmManagement.Shared.Models
@using PigFarmManagement.Client.Features.Customers.Services
@inject ICustomerService CustomerService

<MudDialog>
    <DialogContent>
        <MudContainer Style="max-width: 500px;">
            <MudGrid>
                <MudItem xs="6">
                    <MudTextField @bind-Value="customerFirstName" 
                                 Label="First Name" 
                                 Variant="Variant.Outlined" 
                                 Required="true"
                                 RequiredError="First name is required" />
                </MudItem>
                <MudItem xs="6">
                    <MudTextField @bind-Value="customerLastName" 
                                 Label="Last Name" 
                                 Variant="Variant.Outlined" />
                </MudItem>
                <MudItem xs="12">
                    <MudTextField @bind-Value="customerCode" 
                                 Label="Customer Code" 
                                 Variant="Variant.Outlined" 
                                 Required="true"
                                 RequiredError="Customer code is required" />
                </MudItem>
                <MudItem xs="12">
                    <MudSelect T="CustomerStatus" @bind-Value="customerStatus" 
                              Label="Customer Status" 
                              Variant="Variant.Outlined"
                              Required="true">
                        <MudSelectItem T="CustomerStatus" Value="@CustomerStatus.Active">Active</MudSelectItem>
                        <MudSelectItem T="CustomerStatus" Value="@CustomerStatus.Inactive">Inactive</MudSelectItem>
                    </MudSelect>
                </MudItem>
            </MudGrid>
        </MudContainer>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" 
                  Variant="Variant.Filled" 
                  OnClick="Submit" 
                  Disabled="@(!IsFormValid())">
            Add Customer
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; } = null!;

    private string customerFirstName = "";
    private string customerLastName = "";
    private string customerCode = "";
    private CustomerStatus customerStatus = CustomerStatus.Active;

    void Cancel() => MudDialog.Cancel();

    private bool IsFormValid()
    {
        return !string.IsNullOrWhiteSpace(customerFirstName) &&
               !string.IsNullOrWhiteSpace(customerCode);
    }

    async Task Submit()
    {
        if (!IsFormValid())
            return;

        try
        {
            var customer = new Customer(Guid.NewGuid(), customerCode, customerStatus)
            {
                FirstName = customerFirstName,
                LastName = customerLastName
            };
            var createdCustomer = await CustomerService.CreateCustomerAsync(customer);
            MudDialog.Close(DialogResult.Ok(createdCustomer));
        }
        catch
        {
            MudDialog.Cancel();
        }
    }
}
